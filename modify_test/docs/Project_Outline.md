# 키움증권 자동매매 시스템 프로젝트 개요

## 1. 프로젝트 개요

### 1.1 프로젝트명
**키움증권 API 기반 자동매매 시스템 (AutoTrader)**

### 1.2 프로젝트 목적
키움증권의 Open API를 활용하여 실시간 주식 자동매매를 수행하는 데스크톱 애플리케이션입니다. 사용자가 설정한 조건에 따라 자동으로 매수/매도 주문을 실행하며, 실시간 포트폴리오 관리와 리스크 관리 기능을 제공합니다.

### 1.3 주요 기능

#### 1.3.1 자동매매 기능
- **조건식 기반 매수**: 사용자가 설정한 조건검색식에 편입된 종목을 자동으로 매수
- **조건식 기반 매도**: 매도 조건검색식에 편입된 종목을 자동으로 매도
- **시장가/지정가 주문**: 시장가 또는 현재가 대비 틱 단위 지정가 주문 지원
- **미체결 관리**: 설정된 시간 이상 미체결 시 자동으로 시장가로 정정 주문

#### 1.3.2 리스크 관리 기능
- **손절매 (Stop Loss)**: 평균단가 대비 손실률이 설정값 이하일 때 자동 매도
- **트레일링 스탑**: 수익률이 설정값 이상 달성 후 고점 대비 하락률이 설정값 이하일 때 자동 매도
- **최대 보유 종목 수 제한**: 동시에 자동매매할 수 있는 최대 종목 수 제한

#### 1.3.3 실시간 모니터링
- **계좌 현황**: 보유 종목별 현재가, 매입가, 수익률 등 실시간 조회
- **자동매매 현황**: 자동매매 대상 종목들의 실시간 추적 정보
- **주문 체결 정보**: 실시간 주문 접수 및 체결 내역 확인

### 1.4 기술 스택

#### 1.4.1 프로그래밍 언어 및 프레임워크
- **Python 3.x**: 메인 개발 언어
- **PyQt5**: GUI 프레임워크
- **Qt Designer**: UI 디자인 도구 (main.ui)

#### 1.4.2 핵심 라이브러리
- **requests**: HTTP API 통신
- **websockets**: 실시간 데이터 수신
- **pandas**: 데이터 처리 및 분석
- **loguru**: 로깅 시스템
- **multiprocessing**: 멀티프로세싱 처리

#### 1.4.3 외부 API
- **키움증권 Open API**: 주식 거래 및 시세 데이터
- **WebSocket API**: 실시간 시세 및 체결 정보

### 1.5 시스템 아키텍처

#### 1.5.1 멀티프로세스 구조
시스템은 4개의 독립적인 프로세스로 구성됩니다:

1. **메인 GUI 프로세스** (`kiwoom_rest_api_basic.py`)
   - 사용자 인터페이스 제공
   - 각 프로세스 간 데이터 중계
   - 실시간 화면 업데이트

2. **일반 TR 요청 프로세스** (`tr_process_functions.py`)
   - 계좌 조회, 종목 정보 조회 등 일반적인 API 요청 처리
   - 요청 간격 제어 (API 호출 제한 준수)

3. **주문 전용 프로세스** (`tr_process_functions.py`)
   - 매수/매도/정정/취소 주문 전용 처리
   - 주문 실행 안정성 보장

4. **WebSocket 프로세스** (`websocket_functions.py`)
   - 실시간 시세 데이터 수신
   - 조건검색 실시간 편입/편출 이벤트 처리
   - 실시간 주문 체결 정보 수신

#### 1.5.2 데이터 흐름
```
사용자 입력 → GUI → Queue → 각 전문 프로세스 → API 서버
API 서버 → WebSocket/HTTP → 전문 프로세스 → Queue → GUI → 사용자
```

### 1.6 핵심 비즈니스 로직

#### 1.6.1 자동매수 프로세스
1. 조건검색식 실시간 등록
2. 편입 신호 수신 시 종목 기본정보 조회
3. 매수 가능 여부 확인 (보유 종목 수, 중복 매수 방지 등)
4. 주문 수량 계산 (설정 금액 ÷ 주문가격)
5. 매수 주문 실행
6. 실시간 시세 등록

#### 1.6.2 자동매도 프로세스
1. 보유 종목 실시간 시세 모니터링
2. 손절매/트레일링 스탑 조건 확인
3. 조건 충족 시 자동 매도 주문 실행
4. 매도 완료 시 추적 리스트에서 제거

#### 1.6.3 리스크 관리
- **거래 시간 관리**: 설정된 시간 외에는 거래 중단
- **실시간 등록 한도 관리**: 최대 95종목까지 실시간 등록 가능
- **API 호출 제한 준수**: 각 API별 호출 간격 제어

### 1.7 데이터 저장 및 관리

#### 1.7.1 설정 정보 저장
- **QSettings**: 사용자 설정값 영구 저장
- **키**: 매수/매도 조건, 금액, 시간 설정 등

#### 1.7.2 실시간 데이터 관리
- **pickle 파일**: 실시간 추적 종목 정보 저장 (`realtime_tracking_df.pkl`)
- **주기적 저장**: 5초마다 변경사항 자동 저장

### 1.8 사용자 인터페이스

#### 1.8.1 메인 화면 구성
- **자동매매 제어**: ON/OFF 버튼, 설정 저장
- **매수 설정**: 조건식, 금액, 주문 방식
- **매도 설정**: 조건식, 손절매, 트레일링 스탑
- **시간 설정**: 자동매매 시작/종료 시간

#### 1.8.2 모니터링 화면
- **계좌 현황 탭**: 보유 종목별 상세 정보
- **자동매매 현황 탭**: 추적 중인 종목 정보

### 1.9 모의투자/실투자 지원
- **config.py**: `is_paper_trading` 플래그로 모의투자/실투자 전환
- **API 엔드포인트**: 모의투자와 실투자 서버 자동 선택

### 1.10 예외 처리 및 로깅
- **loguru**: 상세한 로그 기록
- **데코레이터**: `@log_exceptions`로 통합된 예외 처리
- **시스템 안정성**: 예외 발생 시에도 시스템 지속 운영

이 시스템은 개인 투자자가 체계적이고 안전한 자동매매를 수행할 수 있도록 설계된 완성도 높은 소프트웨어입니다.